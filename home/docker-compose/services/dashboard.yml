services:
  dashboard:
    image: imarcagency/ops-apache-php83:${OPS_CONTAINER_VERSION}
    labels:
      - "ops.project=ops"
      - "traefik.enable=true"
      - "traefik.docker.network=ops_gateway"
      - "traefik.http.routers.dashboard.rule=Host(`ops.${OPS_DOMAIN}`) || Host(`dashboard.ops.${OPS_DOMAIN}`)"
      - "traefik.http.routers.dashboard.entrypoints=web,websecure"
      - "traefik.http.routers.dashboard.priority=2"
      - "traefik.http.routers.dashboard.tls=true"
      - "traefik.http.routers.dashboard.service=dashboard"
      - "traefik.http.services.dashboard.loadbalancer.server.port=80"
      - "${OPS_ADMIN_AUTH_LABEL_PREFIX}traefik.http.middlewares.dashboard-auth.basicauth.users=${OPS_ADMIN_AUTH}"
      - "${OPS_ADMIN_AUTH_LABEL_PREFIX}traefik.http.routers.dashboard.middlewares=dashboard-auth"
    environment:
      - APACHE_UID=${OPS_DOCKER_UID}
      - APACHE_GID=${OPS_DOCKER_GID}
      - APACHE_ROOT="/var/www/dashboard/public"
      - OPS_DOMAIN=${OPS_DOMAIN}
      - OPS_ENABLED=1
      - OPS_SITES_DIR=${OPS_SITES_DIR}
      - OPS_VERSION=${OPS_VERSION}
      - OPS_SERVICES=${OPS_SERVICES}
    networks:
      - gateway
      - backend
    volumes:
      - ${OPS_HOME}/www/dashboard:/var/www/dashboard
      - ${OPS_HOME}/apache/configure:/usr/local/bin/docker-configure
      - ${OPS_SITES_DIR}:/var/www/html:cached
